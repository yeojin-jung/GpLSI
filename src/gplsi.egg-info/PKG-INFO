Metadata-Version: 2.4
Name: gplsi
Version: 0.1.0
Summary: Graph-regularized pLSI (GpLSI) for topic modeling on graphs / spatial data.
Author-email: Yeo Jin Jung <jjung1089@gmail.com>
License: MIT
Project-URL: Homepage, https://github.com/yeojin-jung/GpLSI
Project-URL: Issues, https://github.com/yeojin-jung/GpLSI/issues
Keywords: topic modeling,graph regularization,spatial,pLSI,GPLSI
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3 :: Only
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Intended Audience :: Science/Research
Classifier: Topic :: Scientific/Engineering :: Information Analysis
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.20
Requires-Dist: scipy>=1.7
Requires-Dist: pandas>=1.3
Requires-Dist: matplotlib>=3.4
Requires-Dist: seaborn>=0.11
Requires-Dist: scikit-learn>=1.0
Requires-Dist: networkx>=2.6
Requires-Dist: cvxpy>=1.2
Requires-Dist: rpy2>=3.5
Provides-Extra: dev
Requires-Dist: pytest; extra == "dev"
Requires-Dist: black; extra == "dev"
Requires-Dist: ruff; extra == "dev"

# ğŸ“˜ GpLSI: Topic Modeling with Document Graphs

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

Official implementation of **GpLSI** from the paper:

> **Graph Topic Modeling for Documents with Spatial or Covariate Dependencies**  
> Y.J. Jung and C. Donnat
> [[arXiv:2412.14477]](https://arxiv.org/pdf/2412.14477)

This repository provides:

- A cleaned and installable **Python package** `gplsi`
- Code for **synthetic experiments**
- Code for **three real-world datasets** (cellular microenvironments (CODEX), What's cooking?)

---

## ğŸŒŸ Key Features

- **Graph-regularized topic model (GpLSI)** based on **iterative Graph-Aligned SVD**, designed for nonnegative matrix factorization of frequency matrices with an underlying document graph (spatial or covariate-defined).
- **End-to-end spatial omics workflow** with CODEX datasets that demonstrates 
  - how to choose the number of topics (K) using consistency across batches
  - recover and interpret spatially coherent topics
  -	perform downstream prediction tasks (e.g., survival analysis) using the learned topic proportions
- Comparison with existing methods (pLSI, LDA, spatial LDA variants, TopicScore)
- Integrates with:
  - **Anchor-based topic recovery** (Successive Projection Overlapping Clustering (SPOC) from Klopp et al., 2021)
- Works for:
  - Spatial transcriptomics  
  - Cellular microenvironments
  - Texts with metadata
---

## ğŸ“¦ Installation

Clone the repo and install in editable mode:

```bash
git clone https://github.com/yeojin-jung/GpLSI.git
cd GpLSI
pip install -e .
```
This will make the package importable as:
```bash
from gplsi import GpLSI
```

## ğŸ“‚ Repository Structure
```bash
GpLSI/
â”‚
â”œâ”€â”€ src/gplsi/
â”‚   â”œâ”€â”€ gplsi.py                # Main GpLSI class
â”‚   â”œâ”€â”€ graphSVD.py             # Graph-aligned SVD backend
â”‚   â”œâ”€â”€ utils.py                # Internal utilities
â”‚   â”œâ”€â”€ generate_topic_model.py # Synthetic data generator
â”‚   â”œâ”€â”€ realdata_spleen.py      # Spleen real-data pipeline
â”‚   â”œâ”€â”€ realdata_crc.py         # CRC real-data pipeline
â”‚   â”œâ”€â”€ realdata_cook.py        # Whatâ€™s Cooking pipeline
â”‚
â”œâ”€â”€ codes/                      # Run synthetic/real data experiments
â”œâ”€â”€ data/                       # Raw datasets
â”‚
â”œâ”€â”€ tutorial.ipynb              # ğŸ“˜ Complete usage walkthrough
â””â”€â”€ README.md
```
## ğŸ§  Basic Usage
Fit GpLSI to any frequency dataset
```bash
import numpy as np
from gplsi import GpLSI

model = GpLSI(
    lamb_start=1e-4,
    step_size=1.25,
    grid_len=29,
    eps=1e-5,
)

model.fit(
    X,          # (n Ã— p) row-normalized frequency matrix
    N,          # mean row sum of original counts
    K,          # number of topics
    edge_df,    # DataFrame with columns: (src, tgt, weight)
    weights,    # sparse adjacency matrix
)

W = model.W_hat   # topic proportions (n Ã— K)
A = model.A_hat   # topic loadings    (K Ã— p)
```

## ğŸ§ª Running Experiments
All experiment scripts live under codes/ and call the public APIs in src/gplsi.

### 1ï¸âƒ£ Synthetic Simulation Experiments
After installing the package:
```bash
cd codes/
python run_sim.py --task_id 1
```
This will run an experiment with configurations stored in the first row of `codes/config.txt`. 
Or manually specify configurations:
```bash
python run_sim.py \
    --nsim 50 --N 100 --n 1000 --p 30 --K 3
```
### 2ï¸âƒ£ Real Data: Mouse Spleen (CODEX)
We use data from the study â€œDeep Profiling of Mouse Splenic Architecture with CODEX Multiplexed Imagingâ€ by Goltsev et al., published in Cell (2018, Volume 174, Issue 4, pp. 968â€“981.e15).

```bash
python run_spleen.py \
    --K 6 \
    --lamb_start 1e-4 \
    --step_size 1.25 \
    --grid_len 29 \
    --eps 1e-5 \
    --tumor 0   # (BALBc-1)
```
### 3ï¸âƒ£ Real Data: Stanford CRC (CODEX)
```bash
python run_crc.py \
    --K 6 \
    --lamb_start 1e-4 \
    --step_size 1.25 \
    --grid_len 29 \
    --eps 1e-5
```

For this example, we provide a method to choose the **optimal number of topics** by measuring consistency of estimated topics across batches of patients. 
```bash
# run for K = 2,3,...
mpiexec -n 5 python run_crc_choose_ntopics.py \
    --K 6 \ 
    --lamb_start 1e-4 \
    --step_size 1.25 \
    --grid_len 29 \
    --eps 1e-5
```

We also provide the code for postprocessing the result to conduct survival analysis (patient outcome prediction).
```bash
python postprocess_crc.py
```


## ğŸ“œ Citation

If you use this code, please cite:
```bash
@article{jung2024gplsi,
  title={Graph Topic Modeling for Documents with Spatial or Covariate Dependencies},
  author={Jung, Yeo Jin and Donnat, Claire},
  journal={arXiv preprint arXiv:2412.14477},
  year={2025}
}
```
## ğŸ”— Links
- ğŸ“¦ PyPI: 
- ğŸ’» GitHub: https://github.com/yeojin-jung/GpLSI
- ğŸ“‘ Paper: https://arxiv.org/pdf/2412.14477
